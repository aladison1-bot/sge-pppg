<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>SGE PPPG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<div id="app"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCDrzmOYxvrUIeVaeu1ffukT6zIil0QCig",
    authDomain: "sge-pppg.firebaseapp.com",
    projectId: "sge-pppg",
    storageBucket: "sge-pppg.firebasestorage.app",
    messagingSenderId: "472785600880",
    appId: "1:472785600880:web:ba7c403665a9f26ff4cfb5"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const tela = document.getElementById("app");

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      tela.innerHTML = `
        <h2>SGE PPPG</h2>
        <p>Acesso restrito</p>
        <input id="email" placeholder="Email">
        <br><br>
        <input id="senha" type="password" placeholder="Senha">
        <br><br>
        <button id="entrar">Entrar</button>
      `;

      document.getElementById("entrar").onclick = () => {
        signInWithEmailAndPassword(auth, email.value, senha.value)
          .catch(() => alert("Erro de login"));
      };
      return;
    }

    const snap = await getDoc(doc(db, "users", user.uid));

    if (!snap.exists()) {
      tela.innerHTML = "<p>Usuário sem permissão</p>";
      return;
    }

    const dados = snap.data();

    tela.innerHTML = `
      <h1>SGE PPPG</h1>
      <p>${user.email}</p>
      <p>Nível: ${dados.role}</p>
    `;

    if (dados.role === "admin") {
      tela.innerHTML += "<p>Administrador geral</p>";
    }

    if (dados.role === "manager") {
      tela.innerHTML += "<p>Administrador intermediário</p>";
    }

    if (dados.role === "operator") {
      tela.innerHTML += "<p>Operador</p>";
    }
  });
</script>

</body>
</html>
